<script data-provider="sitecues-proxy" type="application/javascript">
    // This script is for testing any release of sitecues
    // Development script injected via sitecues-proxy
    var sitecues = window.sitecues = window.sitecues || {},
        // We need the major and minor version as a string, e.g. '4.0' from full version number '4.0.13'
        userSpecifiedVersion = '{{{VERSION}}}',
        releaseSplit = userSpecifiedVersion.split('.'),
        majorVer = releaseSplit[0],
        minorVer = releaseSplit[1],
        majMinVer = majorVer + '.' + minorVer,
        jsHostName = '{{{JS_HOSTNAME}}}';
    sitecues.config = sitecues.config || {};
    sitecues.config.siteId = '{{{SITE_ID}}}';
    if (userSpecifiedVersion.substring(0,2) === '4.') {
        // Old url format, used to test release 4.x
        sitecues.config.scriptUrl = 'https://' + 
            (jsHostName || 'js.dev.sitecues.com') + 
            '/l/s;id=' + sitecues.config.siteId + 
            '/release-' + majMinVer + '/' + userSpecifiedVersion + '-RELEASE' +
            '/js/sitecues.js';
    }
    else {
        // New url format, uses minicore
        var 
          // Branch of sitecues-core
          coreBranch = '{{{CORE_BRANCH}}}' || 'master',
          // Branch and version of sitecues-js
          userSpecifiedBranch = '{{{BRANCH}}}',
          branchName = userSpecifiedBranch || '~default',
          // Use default/~default if neither branch nor version specified
          defaultVersion = userSpecifiedBranch ? 'latest' : 'default',
          branchVersion = userSpecifiedVersion || defaultVersion;
        sitecues.config.scriptUrl = 'http://' + (jsHostName || 'js.sitecues.com') +
            '/sitecues-core/s;id=' + 
            sitecues.config.siteId + 
            '/' + coreBranch + '/latest/js/sitecues.js';
        sitecues.config.appUrl = {
            branch : branchName,
            version : branchVersion
        };
        console.log(sitecues.config.appUrl);
    }
    sitecues.config.isTester = true;  // Metrics from this user can be filtered out by backend
    // Do not allow the sitecues object to be wiped out or changed to something else,
    // but allow properties to be added to it, e.g. sitecues.$ = jQuery
    Object.defineProperty(window, 'sitecues', { writable: false });
    Object.defineProperty(sitecues, 'config', { writable: false }); // Do not allow reassignment, e.g. sitecues.config = {};
    (function () {
        var script = document.createElement('script'),
            first  = document.getElementsByTagName('script')[0];
        script.type  = 'application/javascript';
        script.src   = sitecues.config.scriptUrl;
        script.setAttribute('crossorigin', 'anonymous');
        first.parentNode.insertBefore(script, first);
    })();
</script>
